---
title: "How It Works"
description: "Sundew's architecture: one Python process with three layers that turn a single binary into a convincing, unique service."
---

Sundew is a single Python process with three layers: traps that serve deceptive content, a fingerprinter that analyzes visitor behavior, and a storage layer that captures everything for analysis.

What makes it different from traditional honeypots is the **persona engine** -- a system that generates a unique, coherent identity for each deployment, making every instance look like a different real service.

## Architecture Overview

```
                     Incoming Request
                           |
                +----------+-----------+
                |                      |
          MCP Protocol           HTTP Request
                |                      |
        +-------+-------+    +---------+---------+
        | MCP Trap      |    | REST API Trap     |
        | Tool calls    |    | CRUD endpoints    |
        +-------+-------+    +---------+---------+
                |                      |
                |    AI Discovery Trap |
                |    /.well-known/*    |
                |    /robots.txt      |
                +----------+-----------+
                           |
                 +---------+---------+
                 | Fingerprinter     |
                 | 5 behavioral      |
                 | signals scored    |
                 | 0.0 - 1.0        |
                 +---------+---------+
                           |
                 +---------+---------+
                 | Classifier        |
                 | human | automated |
                 | ai_assisted |    |
                 | ai_agent        |
                 +---------+---------+
                           |
                 +---------+---------+
                 | Storage           |
                 | SQLite + JSONL    |
                 +-------------------+
```

## Layer 1: Traps

Traps are the outward-facing components -- what visitors see and interact with. Sundew ships with three trap types:

**MCP Server Trap** -- A fully protocol-compliant Model Context Protocol server. AI agents that support MCP will discover and connect to it. The tools advertised depend on the persona: a fintech persona offers `query_transactions`, a SaaS persona offers `list_users`.

**REST API Trap** -- Adaptive HTTP endpoints with Swagger documentation, authentication, and realistic response data. Endpoint paths, field names, and response structures all come from the persona.

**AI Discovery Trap** -- Files that AI agents and crawlers actively seek: `/.well-known/ai-plugin.json`, `/.well-known/mcp.json`, `robots.txt`, `sitemap.xml`, and `openapi.json`.

Every trap reads from the persona -- no trap contains hardcoded response content.

## Layer 2: Fingerprinting

Every request passes through the fingerprinter, which scores five behavioral signals:

| Signal | What it detects |
|--------|----------------|
| **Timing** | Regular inter-request intervals (humans are irregular) |
| **Enumeration** | Systematic path discovery patterns |
| **Headers** | Missing Referer, bot-like User-Agent, unusual Accept headers |
| **Prompt leakage** | LLM artifacts in request bodies ("As an AI assistant...", XML tags) |
| **MCP** | Connection via MCP protocol (very strong signal) |

Each signal produces a score from 0.0 to 1.0. These combine into a composite score that maps to a classification:

| Score Range | Classification | Typical visitor |
|------------|---------------|-----------------|
| < 0.3 | `human` | Manual browsing, curl, Postman |
| 0.3 -- 0.6 | `automated` | Nmap, Nuclei, traditional scanners |
| 0.6 -- 0.8 | `ai_assisted` | Human using AI tools for recon |
| > 0.8 | `ai_agent` | Fully autonomous LLM agent |

Fingerprinting happens per-request and per-session. Individual requests carry some signal, but the session-level pattern is far more revealing.

## Layer 3: Storage

Sundew captures everything in two formats:

**SQLite database** (`./data/sundew.db`) -- Structured storage for sessions, events, fingerprinting scores, and classifications. Queryable via the CLI or the MCP client.

**JSON Lines log** (`./data/events.jsonl`) -- Append-only stream of every event. Each line is a complete JSON object with request details, fingerprinting signals, and session context. Designed for streaming to external systems or post-hoc analysis.

## The Persona Engine

The persona engine is Sundew's core innovation. It solves the fundamental problem with honeypots: once attackers know what one looks like, they can detect and avoid all identical deployments.

### The Problem

Traditional honeypots have fixed signatures. Cowrie always looks like Cowrie. Kippo always looks like Kippo. Security researchers and attackers maintain databases of these signatures. An AI agent with internet access could learn to identify any fixed-signature honeypot.

### The Solution

Sundew generates a unique **deployment persona** -- a coherent identity that shapes every observable aspect of the honeypot. No two deployments look the same, and knowing what one deployment looks like provides zero advantage against any other.

### Generation Flow

```
1. Generate persona (random or operator-defined)
       |
2. LLM generates response templates shaped by persona
       |
3. Templates cached locally (JSON + SQLite)
       |
4. Runtime: serve cached responses
   with variable interpolation (timestamps, IDs, etc.)
```

The LLM is used **only at deploy time**. During normal operation, Sundew serves pre-generated responses with variable interpolation for dynamic fields like timestamps and request IDs. This means:

- Zero LLM latency during operation
- Deterministic and reproducible behavior (important for research)
- Each deployment has completely unique response content
- Works offline after initial generation

### What the Persona Shapes

Everything a visitor observes comes from the persona:

- Company name and branding in API responses
- Endpoint paths and naming conventions
- Response body structure and field names
- Error message format and wording
- HTTP headers (Server, X-Powered-By, X-Request-Id format)
- Timing characteristics (latency jitter range)
- Fake data themes (users, transactions, patients, products)
- MCP tool names and descriptions
- API documentation style and content
- Discovery file contents

### Without an LLM

Sundew ships pre-built persona packs -- complete sets of response templates for common industry themes. These work without any LLM but offer less variety. Multiple deployments using the same pack will share response patterns, reducing anti-fingerprinting effectiveness.

For research deployments, an LLM backend is recommended. For quick testing or air-gapped environments, persona packs work well.

## Request Lifecycle

Here is the complete path of a single request through Sundew:

1. **Request arrives** at the FastAPI server
2. **Middleware** records the raw request (method, path, headers, body, timing)
3. **Router** matches the request to a trap based on the path
4. **Trap** looks up the pre-generated response for this path from the template cache
5. **Variable interpolation** fills in dynamic fields (timestamps, UUIDs, pagination)
6. **Fingerprinter** scores the request across all five signals
7. **Session correlator** groups the request with previous requests from the same source
8. **Classifier** updates the session-level classification
9. **Response** is sent with persona-appropriate headers and timing jitter
10. **Storage** writes the event to SQLite and the JSONL log

Steps 6-8 happen asynchronously -- they do not add latency to the response.

## Next Steps

<CardGroup cols={2}>
  <Card title="Personas" icon="masks-theater" href="/concepts/personas">
    Deep dive into the persona engine and how identities are generated.
  </Card>
  <Card title="Traps" icon="spider-web" href="/concepts/traps">
    Details on each trap type and how they attract AI agents.
  </Card>
  <Card title="Fingerprinting" icon="fingerprint" href="/concepts/fingerprinting">
    How Sundew detects and classifies visitors.
  </Card>
</CardGroup>
